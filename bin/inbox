#!/usr/bin/env bash

API_URL=http://localhost:4000/api/v1/resources
COMMAND="$1"
shift

function list() {
  TAGS=()

  while (( "$#" )); do
    TAGS+=("--data-urlencode tags[]=$1")
    shift
  done

  curl --header "Accept: text/plain" \
    --get ${TAGS[@]} \
    "$API_URL"
}

function add() {
  URL="$1"
  shift

  TAGS=()

  while (( "$#" )); do
    TAGS+=("--data-urlencode resource[tags][]=$1")
    shift
  done

  curl --include \
    --header "Accept: application/json" \
    --data-urlencode "resource[uri]=$URL" \
    ${TAGS[@]} \
    "$API_URL"
}

function help_summary() {
  echo "Usage:
    inbox list [tags]
    inbox add http://www.example.com/ [tags]
  "
}

case $COMMAND in
  add)
    add $@ url shell
    ;;
  list)
    list $@
    ;;
  *)
    help_summary
esac

echo
